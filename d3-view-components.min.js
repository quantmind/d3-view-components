!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-view"),require("d3-let"),require("d3-dispatch"),require("d3-ease"),require("d3-transition"),require("handlebars")):"function"==typeof define&&define.amd?define(["exports","d3-view","d3-let","d3-dispatch","d3-ease","d3-transition","handlebars"],t):t(e.d3=e.d3||{},e.d3,e.d3,e.d3,e.d3,e.d3,e.handlebars)}(this,function(e,t,n,i,o,s,r){"use strict";r=r&&r.hasOwnProperty("default")?r.default:r;t.viewEvents.on("component-created",function(e){e.parent||(e.model.currentUrl=e.providers.location.href)});var a={error:"danger",warn:"warning"},l={props:{transitionDuration:0},model:function(){return{messages:[],$messageClass:function(e){return"alert-"+(a[e.level]||e.level)},$close:function(e){var t=this.messages;delete this.$$messageIds[h(e)];for(var n=0;n<t.length;++n)if(e===t[n]){this.messages=t.slice(),this.messages.splice(n,1);break}}}},render:function(e){var t=this.model,i=t.messages.splice(0),o={},s=t.isolatedRoot;t.$$messageIds=o,s.$alertMessage=r,i.forEach(r);function r(e){if(e&&(n.isString(e)&&(e={message:e}),e.message)){e.level||(e.level="info");var i=h(e),s=o[i];s?s.count+=1:(e.count=1,s=t.$new(e),o[i]=s,t.$push("messages",s))}}return this.renderFromDist("d3-view-components","/alert/template.html",e)}};function h(e){return e.level+"::"+e.message}var u=new RegExp("[^,]*$"),d=new RegExp("^.+,*|"),c={filter:function(e,t){return window.Awesomplete.FILTER_CONTAINS(e,t.match(u)[0])},item:function(e,t){return window.Awesomplete.ITEM(e,t.match(u)[0])},replace:function(e){var t=this.input.value.match(d)[0];this.input.value=t+e+", "}},f={refresh:function(e,t){if(!this.awe){var n=this;this.awe=!0,t=t||{},this.htmlAttribute(t,"multiple"),this.providers.require("awesomplete").catch(function(){if(!window.Awesomplete)return n.logError("Could not load awesomplete");n.build(e,t)})}},build:function(e,t){var n=this,i=n.getConfig(t);t.url?this.json(t.url).then(function(t){var o=t.data;e.$emit("autoCompleteData",o),i.list=o,n.awe=new window.Awesomplete(n.el,i)}):n.awe=new window.Awesomplete(n.el,i)},getConfig:function(e){var t={minChars:e.minChars||2};return(e.label||e.value)&&(e.label||(e.label="label"),e.value||(e.value="value"),t.data=function(t){return{label:t[e.label],value:t[e.value]}}),e.multiple&&n.assign(t,c),t},htmlAttribute:function(e,t){if(void 0===e[t]){var n=this.sel.attr("data-"+t);void 0!==n&&(e[t]=null!==n&&(n||!0))}}},p="collapse",v="d3-collapsing",m="collapsed",g="show",_=i.dispatch("show-start","show-end","hide-start","hide-end"),w={events:_,refresh:function(){if(!this.target){var e=this,t=this.sel,n=t.attr("aria-controls"),i=n?this.select("#"+n):null,o=i?i.node():null;if(o){o.d3Collapse=this,this.target=i,this.smallScreen=t.attr("data-small-screen")||993,this.container=this.getContainer(i);var s=i.classed(g);this.duration=400,this.transitioning=!1,t.classed(m,!s),t.attr("aria-expanded",s),this.on(t,"click."+this.uid,function(t){return e.toggle(i,t)})}}},show:function(e,t){if(!this.transitioning&&!e.classed(g)){t&&t.preventDefault();var n=this,i=this.sel,o=this.getDimension(e);e.classed(p,!1).classed(v,!0).style(o,0),i.classed(m,!1).attr("aria-expanded",!0),this.transitioning=!0;var s="scroll"+(o[0].toUpperCase()+o.slice(1)),r=e.node()[s]+"px";this.container&&this.container.show(r),_.call("show-start",void 0,e),e.transition().duration(this.duration).style(o,r).on("end",function(){n.transitioning=!1,e.classed(v,!1).classed(p,!0).classed(g,!0),e.style(o,""),_.call("show-end",void 0,e)})}},hide:function(e,t){if(!this.transitioning&&e.classed("show")){t&&t.preventDefault();var n=this,i=this.sel,o=this.getDimension(e);e.classed(v,!0).classed(p,!1).classed(g,!1),i.classed(m,!0).attr("aria-expanded",!1),this.transitioning=!0,e.style(o,""),this.container&&this.container.hide(),_.call("hide-start",void 0,e),e.transition().duration(this.duration).style(o,"0px").on("end",function(){n.transitioning=!1,e.classed(v,!1).classed(p,!0),_.call("hide-end",void 0,e)})}},toggle:function(e,t){"false"===this.sel.attr("aria-expanded")?this.show(e,t):this.hide(e,t)},getDimension:function(e){return e.classed("width")?"width":"height"},getContainer:function(e){var t=this,n=e.attr("data-container"),i=n?this.select(e.node().parentNode):null;if(i){var o=this.getSize(e);return this.select(window).on("resize."+this.uid,function(){o=t.getSize(e,o)}),{show:function(e){i.transition().duration(t.duration).style(n,e).on("end",function(){i.classed(g,!0).style(n,"")})},hide:function(){i.transition().duration(t.duration).style(n,"0px").on("end",function(){i.classed(g,!1)})}}}},getSize:function(e,t){var n=this.select("body").style("width"),i=+ +n.substring(0,n.length-2)<this.smallScreen;return void 0===t?i&&e.classed(g,!1):i!==t&&(i?this.hide(e):this.show(e)),i},destroy:function(){this.target&&this.target.on("click."+this.uid,null)}},y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,o=!1,s=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){o=!0,s=e}finally{try{!i&&a.return&&a.return()}finally{if(o)throw s}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),R={refresh:function(e,t){var n,i,o=this,s=this.providers.require;o.sel.classed("markdown-body",!0),Promise.all([s("marked"),s("highlightjs")]).then(function(s){var r=b(s,2);n=r[0],i=r[1],o._markedOptions||(o._markedOptions=o.markedOptions(e,n,i)),o.sel.html(t?n(t,o._markedOptions):""),e.$emit("markedElement",o.el),o.selectChildren().mount()})},markedOptions:function(e,n,i){if(this._markedOptions)return self._markedOptions;var o=new n.Renderer,s=e.markedAnchorIcon||"ion-ios-grid-view-outline";return o.heading=function(e,n){var i=t.viewSlugify(e);return"<h"+n+'><a href="#'+i+'" aria-hidden="true" class="anchor" id="content-'+i+'"><i class="'+s+'"></i></a> '+e+"</h"+n+">"},{renderer:o,highlight:function(e,t){return t=i.getLanguage(t)?[t]:void 0,i.highlightAuto(e,t).value},langPrefix:"hljs "}}},E=t.viewBase.select,k={props:{transitionDuration:300},model:{modalTitle:"d3-view modal",modalBody:"",modalDisabled:!1,modalActions:[{label:"Close"}],showModal:!1,$showModal:function(){this.showModal=!0},$hideModal:function(){this.showModal=!1},$actionClass:function(e){return e.level?"btn-"+e.level:"btn-secondary"},$action:function(e){e.$action?e.$action():this.$hideModal()},$actionLabel:function(e){return""+(e.icon?"<i class='"+e.icon+"'></i> ":"")+e.label}},render:function(e){return this.renderFromDist("d3-view-components","/modal/template.html",e)}},A={refresh:function(e,t){if(this.passes){var n=this.sel,i=n.classed("modal"),s=void 0;if(t)n.style("display","block").classed("show",!0),i&&(s=n.style("height"),n.style("top","-"+s),this.transition(n).ease(o.easeExpOut).style("top","0px"));else{var r=n.style("opacity"),a=this.transition(n);n.classed("show",!1),i?(s=n.style("height"),a.style("top","-"+s).on("end",function(){n.style("display","none")})):a.style("opacity",0),a.on("end",function(){n.style("display","none").style("opacity",r)})}}}},L={modalComponent:k,modalDirective:A,modalOpen:$,install:function(e){e.addComponent("modal",k),e.addDirective("modal",A),e.model.$openModal=$}};function $(e){n.isString(e)&&(e=function(e){var n=E(e);return 1===n.size()?{modalTitle:C(n.select("modal-title")),modalBody:C(n.select("modal-body"))}:(t.viewWarn('Could not obtain target from selector "'+e+'"'),{})}(e));var i=E("#d3-view-modal");i.size()?i.model().$update(e).$showModal():E("body").append("modal").mount(e,function(e){return e.model.$showModal()})}function C(e){return e.size()?e.html():""}var I={props:{id:"sidebar",brand:"sidebar",classes:"navbar-sidebar navbar sticky-top navbar-dark bg-primary",brandUrl:"/",itemAttr:""},model:{primaryItems:[],secondaryItems:[],sidebarToggle:'<i class="ion-android-menu"></i>',navbarItems:[],navbarTitle:"",navbarTitleUrl:"/",$collapse:function(){var e=this.$event?this.$event.currentTarget.d3Collapse:null;e&&e.hide(e.select(this.$event.currentTarget))}},render:function(e,t,n){var i=this.model;return P(i,i.primaryItems),P(i,i.secondaryItems),P(i,i.navbarItems),e.sidebarContent=this.select(n).html(),this.renderFromDist("d3-view-components","/sidebar/template.html",e)}};function P(e,n){for(var i=void 0,o=0;o<n.length;++o)"string"==typeof(i=n[o])&&(i={name:i}),i instanceof t.viewModel||(i=e.$new(i)),i.href||i.$set("href",i.name),n[o]=i}var H={none:null,tabs:"nav-tabs",pills:"nav-pills"},S={props:{tabTransitionDuration:250},model:function(){return{tabItems:[],tabType:"tabs",tabTarget:"",tabClass:{reactOn:["tabType"],get:function(){return H[this.tabType]}},$selectTab:function(e){n.isObject(e)&&(e=e.href);var t=this.targets.get(e),i=this.$event;if(t)this.tabTarget=t,i&&i.currentTarget&&(this.currentUrl=i.currentTarget.href);else{var o=this.$$view.root.router;o&&i&&i.currentTarget&&(i.preventDefault(),o.navigate(i.currentTarget.href,!0))}this.tabItems.forEach(function(t){t.active=t.href===e})}}},render:function(e,i,o){var s=this,r=this.model,a=r.tabItems;return r.targets=new Map,a.forEach(function(e,i){return n.isString(e)&&(e=r.$new({label:e}),a[i]=e),e.label||(e.label="item "+(i+1)),e.id||(e.id=t.viewSlugify(e.label)),e.href||(e.href="#"+e.id),e}),this.selectChildren(o).each(function(e){var t=s.select(this),n=t.attr("id")||(a[e]?a[e].id:null);n&&r.targets.set("#"+n,t.html())}),this.renderFromDist("d3-view-components","/tabs/template.html",e)},mounted:function(){}};function D(){return!("undefined"==typeof window||!window.history||!window.history.pushState)}function T(e,t,n){this.root=null,this._routes=[],this._useHash=t,this._hash=void 0===n?"#":n,this._paused=!1,this._destroyed=!1,this._lastRouteResolved=null,this._notFoundHandler=null,this._defaultHandler=null,this._usePushState=!t&&D(),this._onLocationChange=this._onLocationChange.bind(this),this._genericHooks=null,this._historyAPIUpdateMethod="pushState",e?this.root=t?e.replace(/\/$/,"/"+this._hash):e.replace(/\/$/,""):t&&(this.root=this._cLoc().split(this._hash)[0].replace(/\/$/,"/"+this._hash)),this._listen(),this.updatePageLinks()}function O(e){return e instanceof RegExp?e:e.replace(/\/+$/,"").replace(/^\/+/,"^/")}function M(e){return e.replace(/\/$/,"").split("/").length}function x(e,t){return M(t)-M(e)}function F(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).map(function(t){var n,i,o=function(e){var t=[];return{regexp:e instanceof RegExp?e:new RegExp(e.replace(T.PARAMETER_REGEXP,function(e,n,i){return t.push(i),T.REPLACE_VARIABLE_REGEXP}).replace(T.WILDCARD_REGEXP,T.REPLACE_WILDCARD)+T.FOLLOWED_BY_SLASH_REGEXP,T.MATCH_REGEXP_FLAGS),paramNames:t}}(O(t.route)),s=o.regexp,r=o.paramNames,a=e.replace(/^\/+/,"/").match(s),l=(n=a,i=r,0===i.length?null:n?n.slice(1,n.length).reduce(function(e,t,n){return null===e&&(e={}),e[i[n]]=decodeURIComponent(t),e},null):null);return!!a&&{match:a,route:t,params:l}}).filter(function(e){return e})}function U(e,t){return F(e,t)[0]||!1}function q(e,t){var n=t.map(function(t){return""===t.route||"*"===t.route?e:e.split(new RegExp(t.route+"($|/)"))[0]}),i=O(e);return n.length>1?n.reduce(function(e,t){return e.length>t.length&&(e=t),e},n[0]):1===n.length?n[0]:i}function G(e,t,n){var i,o=function(e){return e.split(/\?(.*)?$/)[0]};return void 0===n&&(n="#"),D()&&!t?o(e).split(n)[0]:(i=e.split(n)).length>1?o(i[1]):o(i[0])}function j(e,t,n){t&&"object"===(void 0===t?"undefined":y(t))?t.before?t.before(function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(e(),t.after&&t.after(n))},n):t.after&&(e(),t.after&&t.after(n)):e()}T.prototype={helpers:{match:U,root:q,clean:O,getOnlyURL:G},navigate:function(e,t){var n;return e=e||"",this._usePushState?(n=(n=(t?"":this._getRoot()+"/")+e.replace(/^\/+/,"/")).replace(/([^:])(\/{2,})/g,"$1/"),history[this._historyAPIUpdateMethod]({},"",n),this.resolve()):"undefined"!=typeof window&&(e=e.replace(new RegExp("^"+this._hash),""),window.location.href=window.location.href.replace(/#$/,"").replace(new RegExp(this._hash+".*$"),"")+this._hash+e),this},on:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];if("function"==typeof n[0])this._defaultHandler={handler:n[0],hooks:n[1]};else if(n.length>=2)if("/"===n[0]){var o=n[1];"object"===y(n[1])&&(o=n[1].uses),this._defaultHandler={handler:o,hooks:n[2]}}else this._add(n[0],n[1],n[2]);else if("object"===y(n[0])){Object.keys(n[0]).sort(x).forEach(function(t){e.on(t,n[0][t])})}return this},off:function(e){return null!==this._defaultHandler&&e===this._defaultHandler.handler?this._defaultHandler=null:null!==this._notFoundHandler&&e===this._notFoundHandler.handler&&(this._notFoundHandler=null),this._routes=this._routes.reduce(function(t,n){return n.handler!==e&&t.push(n),t},[]),this},notFound:function(e,t){return this._notFoundHandler={handler:e,hooks:t},this},resolve:function(e){var t,n,i=this,o=(e||this._cLoc()).replace(this._getRoot(),"");this._useHash&&(o=o.replace(new RegExp("^/"+this._hash),"/"));var s,r=(s=e||this._cLoc(),s.split(/\?(.*)?$/).slice(1).join("")),a=G(o,this._useHash,this._hash);return!this._paused&&(this._lastRouteResolved&&a===this._lastRouteResolved.url&&r===this._lastRouteResolved.query?(this._lastRouteResolved.hooks&&this._lastRouteResolved.hooks.already&&this._lastRouteResolved.hooks.already(this._lastRouteResolved.params),!1):(n=U(a,this._routes))?(this._callLeave(),this._lastRouteResolved={url:a,query:r,hooks:n.route.hooks,params:n.params,name:n.route.name},t=n.route.handler,j(function(){j(function(){n.route.route instanceof RegExp?t.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(n.match.slice(1,n.match.length))):t(n.params,r)},n.route.hooks,n.params,i._genericHooks)},this._genericHooks,n.params),n):this._defaultHandler&&(""===a||"/"===a||a===this._hash||function(e,t,n){if(D()&&!t)return!1;if(!e.match(n))return!1;var i=e.split(n);return i.length<2||""===i[1]}(a,this._useHash,this._hash))?(j(function(){j(function(){i._callLeave(),i._lastRouteResolved={url:a,query:r,hooks:i._defaultHandler.hooks},i._defaultHandler.handler(r)},i._defaultHandler.hooks)},this._genericHooks),!0):(this._notFoundHandler&&j(function(){j(function(){i._callLeave(),i._lastRouteResolved={url:a,query:r,hooks:i._notFoundHandler.hooks},i._notFoundHandler.handler(r)},i._notFoundHandler.hooks)},this._genericHooks),!1))},destroy:function(){this._routes=[],this._destroyed=!0,clearTimeout(this._listeningInterval),"undefined"!=typeof window&&(window.removeEventListener("popstate",this._onLocationChange),window.removeEventListener("hashchange",this._onLocationChange))},updatePageLinks:function(){var e=this;"undefined"!=typeof document&&this._findLinks().forEach(function(t){t.hasListenerAttached||(t.addEventListener("click",function(n){var i=e.getLinkPath(t);e._destroyed||(n.preventDefault(),e.navigate(i.replace(/\/+$/,"").replace(/^\/+/,"/")))}),t.hasListenerAttached=!0)})},generate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._routes.reduce(function(n,i){var o;if(i.name===e){n=i.route;for(o in t)n=n.toString().replace(":"+o,t[o])}return n},"");return this._useHash?this._hash+n:n},link:function(e){return this._getRoot()+e},pause:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._paused=e,this._historyAPIUpdateMethod=e?"replaceState":"pushState"},resume:function(){this.pause(!1)},historyAPIUpdateMethod:function(e){return void 0===e?this._historyAPIUpdateMethod:(this._historyAPIUpdateMethod=e,e)},disableIfAPINotAvailable:function(){D()||this.destroy()},lastRouteResolved:function(){return this._lastRouteResolved},getLinkPath:function(e){return e.getAttribute("href")},hooks:function(e){this._genericHooks=e},_add:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"string"==typeof e&&(e=encodeURI(e)),"object"===(void 0===t?"undefined":y(t))?this._routes.push({route:e,handler:t.uses,name:t.as,hooks:n||t.hooks}):this._routes.push({route:e,handler:t,hooks:n}),this._add},_getRoot:function(){return null!==this.root?this.root:(this.root=q(this._cLoc().split("?")[0],this._routes),this.root)},_listen:function(){var e=this;if(this._usePushState)window.addEventListener("popstate",this._onLocationChange);else if("undefined"!=typeof window&&"onhashchange"in window)window.addEventListener("hashchange",this._onLocationChange);else{var t=this._cLoc(),n=void 0,i=void 0;(i=function(){n=e._cLoc(),t!==n&&(t=n,e.resolve()),e._listeningInterval=setTimeout(i,200)})()}},_cLoc:function(){return"undefined"!=typeof window?void 0!==window.__NAVIGO_WINDOW_LOCATION_MOCK__?window.__NAVIGO_WINDOW_LOCATION_MOCK__:O(window.location.href):""},_findLinks:function(){return[].slice.call(document.querySelectorAll("[data-navigo]"))},_onLocationChange:function(){this.resolve()},_callLeave:function(){this._lastRouteResolved&&this._lastRouteResolved.hooks&&this._lastRouteResolved.hooks.leave&&this._lastRouteResolved.hooks.leave()}},T.PARAMETER_REGEXP=/([:*])(\w+)/g,T.WILDCARD_REGEXP=/\*/g,T.REPLACE_VARIABLE_REGEXP="([^/]+)",T.REPLACE_WILDCARD="(?:.*)",T.FOLLOWED_BY_SLASH_REGEXP="(?:/$|$)",T.MATCH_REGEXP_FLAGS="";t.viewProviders.compileTemplate=r.compile,e.viewComponentsVersion="0.0.6",e.viewActive={mount:function(e){var t=this;return e.$on("currentUrl."+this.uid,function(){return t.refresh(e)}),e},refresh:function(e){var t=this.el.href,n=e.currentUrl,i=this.sel;if(i.classed("active",!1),t&&n&&t===n.substring(0,t.length)&&(null===i.attr("data-active-strict")||t===n)){var o=n.substring(t.length),s=o.substring(0,1);o&&"/"!==s&&"#"!==s||this.sel.classed("active",!0)}},destroy:function(e){e&&e.$off("currentUrl."+this.uid)}},e.viewAlert=l,e.viewAutocomplete=f,e.viewCollapse=w,e.viewFlatpickr={refresh:function(e,t){var n=this,i=t&&t.$data?t.$data():{};this.providers.require("flatpickr").then(function(t){n.fp&&n.fp.destroy(),n.sel.on("input",null),n.sel.on("change",null),e.$emit("flatpickr",i),n.fp=t(n.el,i)})},destroy:function(){this.fp&&(this.fp.destroy(),this.fp=null)}},e.viewMarked=R,e.viewModal=L,e.viewSidebar=I,e.viewTabs=S,e.viewRouter=function(e,n){n=n||{};var o=i.dispatch("before","after","leave"),s=new T(e.providers.resolve(n.basePath||"/"));return e.router=s,e.routerEvents=o,e.updatePageLinks=t.viewDebounce(function(){e.logDebug("update page links"),e.router.updatePageLinks()}),n.routes&&n.routes(e),s.hooks({before:function(t,n){o.call("before",void 0,e,n),t()},after:function(t){var n=e.providers.location.href;e.model.$set("currentUrl",n),o.call("after",void 0,e,t)},leave:function(t){o.call("leave",void 0,e,t)}}),t.viewEvents.on("component-mounted",function(t){t.root===e&&(e.updatePageLinks(),t===e&&!1!==n.autoResolve&&(e.logDebug("Resolve route with router"),e.router.resolve()))}),e},Object.defineProperty(e,"__esModule",{value:!0})});